# Story 2.4.1: Authentication UI Completion

## Status

Pending Approval

## Story

**As a** Frontend Developer,
**I want** to create comprehensive authentication UI components (login modal, logout functionality) with 5 design variations for stakeholder selection,
**so that** users can authenticate properly with the backend APIs from Story 2.4 and have a complete auth experience integrated with the existing registration system from Story 1.2.1.

## Acceptance Criteria

**AC1:** Create 5 distinct authentication UI design variations that integrate with the existing TBAT design system and are displayed on a single comparison page for stakeholder selection

**AC2:** Implement login modal component that works seamlessly with the backend authentication APIs from Story 2.4 (POST /api/auth/signin)

**AC3:** Create logout functionality with proper state management and user feedback that integrates with JWT session management from Story 2.4

**AC4:** Implement authentication state management UI showing logged-in/logged-out states with user session information

**AC5:** Add protected route indicators and authentication status display that works with existing registration flow from Story 1.2.1

**AC6:** Ensure all authentication components are mobile-responsive and follow TBAT medical academic color palette and Thai language requirements

## Human-in-Loop Design Selection Process

**CRITICAL**: This story requires human approval before implementation proceeds.

### Phase 1: Design Presentation (Developer Task 1)

Create a single comparison page (`/auth-ui-options`) displaying all 5 design variations side-by-side with:
- Interactive mockups using existing shadcn/ui components
- TBAT design system compliance (#0d7276 primary, #529a9d secondary, #cae0e1 light)
- Thai language labels and messaging
- Mobile-responsive previews
- Clear design option labels (Option A, B, C, D, E)

### Phase 2: Stakeholder Selection (Human Decision)

**HALT DEVELOPMENT** until stakeholder selects preferred design option by:
- Reviewing all 5 options on the comparison page
- Considering mobile usability and Thai user experience
- Selecting one option for final implementation
- Documenting selection rationale in story comments

### Phase 3: Implementation (Developer Task 2-6)

Proceed with full implementation of selected design only after human approval documented in story.

## Authentication UI Design Options

### Option A: Modal-Centered Traditional
**Concept**: Classic login modal with centered form layout
- **Login Modal**: Center-screen overlay with email/password fields
- **Logout**: Simple dropdown menu with "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö" button
- **State Indicator**: Text-based "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö [‡∏ä‡∏∑‡πà‡∏≠]" in header
- **Protected Routes**: Simple redirect to login modal
- **Visual Style**: Traditional card-based modal with TBAT teal borders

### Option B: Slide-In Panel Modern
**Concept**: Modern slide-in authentication panel from right side
- **Login Modal**: Slide-in panel (320px width) with animated entry
- **Logout**: Icon button with confirmation tooltip
- **State Indicator**: Avatar circle with initials and name dropdown
- **Protected Routes**: Inline authentication prompt within page content
- **Visual Style**: Sleek panel with TBAT gradient background and subtle shadows

### Option C: Bottom Sheet Mobile-First
**Concept**: Mobile-native bottom sheet design with desktop adaptation
- **Login Modal**: Bottom sheet (mobile) / centered modal (desktop)
- **Logout**: Swipe gesture + button confirmation
- **State Indicator**: Profile chip with Thai name and medical stethoscope icon
- **Protected Routes**: Bottom sheet authentication with progress indicator
- **Visual Style**: iOS/Android-inspired with TBAT medical color transitions

### Option D: Inline Form Seamless
**Concept**: Seamless inline authentication without modal overlays
- **Login Modal**: Smooth page transition to dedicated login page
- **Logout**: Contextual button within user menu sections
- **State Indicator**: Integrated header section with session timer display
- **Protected Routes**: Inline form replacement within page content
- **Visual Style**: Native page integration with TBAT academic styling

### Option E: Floating Action Minimalist
**Concept**: Minimalist floating action button approach
- **Login Modal**: Compact floating form (280px) positioned contextually
- **Logout**: Single-tap floating action button with subtle animation
- **State Indicator**: Minimalist floating profile badge with Thai initial
- **Protected Routes**: Contextual floating prompt at point of need
- **Visual Style**: Clean floating elements with TBAT teal accent colors

## Tasks / Subtasks

### Task 1: Create Design Options Comparison Page (AC: 1)
**üö® DEVELOPMENT GATE 1**: MANDATORY STOP after completion for stakeholder review

- [ ] Create `/auth-ui-options` route for design comparison
- [ ] Implement 5 interactive mockups using shadcn/ui components
- [ ] Apply TBAT design system to all options (#0d7276, #529a9d, #cae0e1)
- [ ] Add Thai language labels: "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å A", "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å B", etc.
- [ ] Include mobile responsive previews for each option
- [ ] Add selection buttons for stakeholder choice recording
- [ ] Document implementation details for each design approach
- [ ] Create stakeholder notification for review completion

**üö® CRITICAL DEVELOPMENT GATE**: Do not proceed to Task 2 until:
1. Human selection is documented in Dev Agent Record
2. PO approval is recorded with selected option (A/B/C/D/E)
3. Any additional requirements are documented

### Task 2: Implement Selected Login Modal (AC: 2)
**üö® DEVELOPMENT GATE 2**: Only proceed after Gate 1 clearance
**Prerequisites**: Human selection completed and documented from Task 1

- [ ] Create login modal component based on selected design option
- [ ] Integrate with POST /api/auth/signin endpoint from Story 2.4
- [ ] Implement email/password form validation with Thai error messages
- [ ] Add loading states and error handling for authentication failures
- [ ] Include "‡∏à‡∏î‡∏à‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" (remember me) functionality
- [ ] Test integration with existing registration flow from Story 1.2.1

### Task 3: Create Logout Functionality (AC: 3)
**Prerequisites**: Task 2 completed

- [ ] Implement logout component based on selected design approach
- [ ] Integrate with JWT session management from Story 2.4
- [ ] Add confirmation dialog: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?"
- [ ] Clear user session and redirect appropriately
- [ ] Update authentication state throughout application
- [ ] Include loading animation during logout process

### Task 4: Authentication State Management UI (AC: 4)
**Prerequisites**: Tasks 2-3 completed

- [ ] Create user session display component
- [ ] Show authenticated user information (Thai name, email)
- [ ] Display session expiration countdown when applicable
- [ ] Implement automatic logout warning notifications
- [ ] Add session refresh functionality for extended usage
- [ ] Update navigation components with authenticated state

### Task 5: Protected Route Integration (AC: 5)
**Prerequisites**: Tasks 2-4 completed

- [ ] Create protected route wrapper components
- [ ] Integrate with existing registration flow authentication
- [ ] Add route guards for authenticated-only sections
- [ ] Implement authentication redirects with return URL preservation
- [ ] Create authentication required indicators
- [ ] Test compatibility with existing routing from Story 1.2.1

### Task 6: Mobile Responsiveness and Thai Language (AC: 6)
**Prerequisites**: All previous tasks completed

- [ ] Validate mobile responsiveness across all authentication components
- [ ] Test Thai language display and input handling
- [ ] Ensure TBAT color palette consistency (#0d7276, #529a9d, #cae0e1)
- [ ] Add medical stethoscope icon integration where appropriate
- [ ] Implement touch-friendly interactions for mobile devices
- [ ] Test accessibility with Thai screen readers

### Task 7: Integration Testing and Validation (AC: All)
**Prerequisites**: All implementation tasks completed

- [ ] Test complete authentication flow: login ‚Üí use app ‚Üí logout
- [ ] Validate integration with Story 1.2.1 registration system
- [ ] Test protected route access and redirects
- [ ] Verify error handling and Thai language messaging
- [ ] Conduct mobile device testing across iOS/Android browsers
- [ ] Performance testing with authentication state management

## Dev Notes

### Previous Story Context

**Story 1.2.1 Delivered Registration Frontend:**
- ‚úÖ Complete 3-step registration flow with password fields
- ‚úÖ Session selection (09:00-12:00 / 13:00-16:00) with capacity display
- ‚úÖ Thai language validation messages and mobile-responsive design
- ‚úÖ PDPA consent integration and shadcn/ui component usage

**Story 2.4 Delivered Backend APIs:**
- ‚úÖ POST /api/auth/register - Registration endpoint (no email verification)
- ‚úÖ POST /api/auth/signin - Login endpoint with enhanced security
- ‚úÖ Password reset APIs: /api/auth/forgot-password, /api/auth/reset-password
- ‚úÖ JWT session management with account lockout protection
- ‚úÖ Rate limiting and comprehensive security audit logging

### Authentication Flow Integration

**Registration ‚Üí Authentication Flow:**
1. User completes registration (Story 1.2.1) ‚Üí User record created (Story 2.4)
2. User receives "Registration successful. Welcome to TBAT Mock Exam!" message
3. User can immediately login using registered email/password
4. Authentication state persists for 7 days (JWT expiry from Story 2.4)

### Design System Requirements

**TBAT Medical Academic Color Palette:**
- **Primary**: #0d7276 (dark teal) - main CTAs, headers, focus states
- **Secondary**: #529a9d (medium teal) - secondary buttons, borders
- **Light**: #cae0e1 (light teal) - backgrounds, subtle accents
- **Clean**: #fdfefe (white) - card backgrounds, content areas
- **Gray**: #90bfc0 (soft gray) - text, disabled states

**Thai Language Considerations:**
- All authentication messages in Thai language
- Proper font rendering for Thai characters (Noto Sans Thai)
- Cultural considerations: formal language for medical context
- Error messages should be helpful and respectful

### Technical Integration Points

**File Locations:**
- `/auth-ui-options` page: `apps/web/app/auth-ui-options/page.tsx`
- Login Modal: `apps/web/components/auth/login-modal.tsx`
- Logout Component: `apps/web/components/auth/logout-button.tsx`
- Auth State Provider: `apps/web/providers/auth-provider.tsx`
- Protected Route Wrapper: `apps/web/components/auth/protected-route.tsx`

**API Integration:**
- Use existing authentication endpoints from Story 2.4
- Implement JWT token management with 7-day expiry
- Handle rate limiting responses (429 status codes)
- Integrate with existing security audit logging

**State Management:**
- Use React Context for authentication state
- Persist login state in localStorage/sessionStorage
- Implement automatic token refresh before expiry
- Handle concurrent session management

**Network Error Handling Scenarios:**
- Network timeout errors (> 30 seconds): Show retry with Thai message "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"
- Server 500 errors: Display "‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á"
- Network disconnection: Show offline indicator "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï"
- API timeout during login: Implement exponential backoff retry (1s, 2s, 4s)
- Rate limiting (429): Display cooldown timer with Thai message
- Invalid token errors: Automatic logout with explanation

### Testing

**Unit Testing Framework:** Jest with React Testing Library
**Test File Location:** Co-located with components (*.test.tsx)

**Unit Test Coverage:**
- Each authentication component (login modal, logout button, auth provider)
- Authentication state management logic and context providers
- Form validation rules and error message display
- Thai language message rendering and font handling
- Network error handling and retry logic
- JWT token management and expiry handling

**Integration Testing Framework:** Jest with MSW (Mock Service Worker)
**Integration Test Scenarios:**
- Complete authentication flow with mocked backend APIs
- Registration ‚Üí Login ‚Üí Logout workflow end-to-end
- Protected route access validation and redirect logic
- Authentication state persistence across browser sessions
- Mobile responsive behavior across viewport sizes
- Rate limiting integration and user feedback

**E2E Testing Framework:** Playwright
**E2E Test Critical Paths:**
- User journey: Registration (Story 1.2.1) ‚Üí Login ‚Üí App usage ‚Üí Logout
- Authentication error scenarios: Invalid credentials, network failures, timeouts
- Mobile device testing: iOS Safari and Android Chrome with Thai language input
- Cross-browser compatibility: Chrome, Safari, Firefox, Edge
- Performance testing: Login modal response time < 200ms
- Thai language input validation and display accuracy

**Mobile-Specific Testing:**
- iOS Safari: Thai keyboard input handling and autocomplete
- Android Chrome: Touch interaction responsiveness
- Viewport adaptation: 320px to 1920px width testing
- Touch target accessibility: Minimum 44px touch areas
- Network condition simulation: 3G, 4G, WiFi scenarios

### Security Considerations

**Frontend Security Measures:**
- JWT tokens stored securely (httpOnly cookies preferred)
- Automatic logout on token expiry
- Rate limiting awareness and user feedback
- CSRF protection integration with Next.js
- Input sanitization for authentication forms

**Integration with Story 2.4 Security:**
- Account lockout UI feedback (5 failed attempts = 30-minute cooldown)
- Rate limiting message display in Thai
- Security event logging integration (login attempts, logouts)
- Password reset flow integration with existing APIs

## Change Log

| Date       | Version | Description                                          | Author |
| ---------- | ------- | ---------------------------------------------------- | ------ |
| 2025-09-13 | 1.0     | Initial story creation for authentication UI completion with 5 design options and human-in-loop approval process | SM Bob |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

**IMPORTANT**: Development must halt after Task 1 completion until human design selection is documented in this section.

### Human Design Selection Record

**Selection Date**: _[To be filled by human reviewer]_
**Selected Option**: _[A/B/C/D/E to be selected by stakeholder]_
**Selection Rationale**: _[Reasoning for choice to be provided by human]_
**Additional Requirements**: _[Any modifications or additional requirements from human]_

### Implementation Notes

_[To be completed by development agent after human approval]_

---

## QA Results

### Review Date: [To be completed during QA review]

### Reviewed By: [Test Architect Name]

### Code Quality Assessment

[To be completed during QA review phase]

### Refactoring Performed

[To be documented by QA team during review]

### Compliance Check

- **Coding Standards**: [To be assessed]
- **Project Structure**: [To be assessed]
- **Testing Strategy**: [To be assessed]
- **All ACs Met**: [To be assessed]

### Improvements Checklist

[To be completed during QA review]

### Security Review

[To be completed during security assessment]

### Performance Considerations

[To be completed during performance review]

### Requirements Traceability Analysis

| AC | Implementation | Test Coverage | Status |
|---|---|---|---|
| **AC1** | [To be verified] | [To be verified] | [PENDING] |
| **AC2** | [To be verified] | [To be verified] | [PENDING] |
| **AC3** | [To be verified] | [To be verified] | [PENDING] |
| **AC4** | [To be verified] | [To be verified] | [PENDING] |
| **AC5** | [To be verified] | [To be verified] | [PENDING] |
| **AC6** | [To be verified] | [To be verified] | [PENDING] |

### Files Modified During Review

[To be documented during QA review]

### Gate Status

Gate: [To be determined] ‚Üí docs/qa/gates/2.4.1-authentication-ui-completion.yml

### Recommended Status

[To be determined during QA review]

---

**üö® HUMAN APPROVAL REQUIRED**: This story cannot proceed to full implementation without stakeholder design selection after Task 1 completion.