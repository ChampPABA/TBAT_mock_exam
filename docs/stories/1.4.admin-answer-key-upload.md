# Story 1.4 - Admin Answer Key Upload

## Story Overview
**Story ID:** 1.4  
**Title:** Admin Answer Key Upload System  
**Epic:** Admin Panel - Results Management  
**Priority:** Medium (Post-Results Feature)  
**Story Points:** 5  

## User Story
As an **admin**, I want to **upload answer key PDF files and publish them to VVIP students** so that **students can download detailed explanations after exam completion**.

## Background & Context
The TBAT exam system requires a simple way for admin staff to provide answer keys to VVIP tier students. Rather than complex generation systems, admins will create PDFs externally and upload them through the admin panel.

## Acceptance Criteria

### ✅ Core Upload Functionality
- [ ] **AC1:** Admin can select and upload PDF files (max 50MB)
- [ ] **AC2:** System validates file type (PDF only) and size constraints
- [ ] **AC3:** Admin sees upload progress indicator during file transfer
- [ ] **AC4:** System displays upload success/failure messages clearly
- [ ] **AC5:** Admin can preview uploaded PDF before publishing

### ✅ Publishing Controls
- [ ] **AC6:** Admin can publish answer key with single click action
- [ ] **AC7:** System confirms publishing action with clear dialog
- [ ] **AC8:** Published status is clearly displayed in admin interface
- [ ] **AC9:** Admin can replace/update answer key if needed
- [ ] **AC10:** System logs all upload and publish actions with timestamps

### ✅ Student Access Integration
- [ ] **AC11:** VVIP students see download link only after admin publishes
- [ ] **AC12:** FREE tier students see upgrade prompt instead of download
- [ ] **AC13:** Download tracking shows how many students accessed the file
- [ ] **AC14:** System handles concurrent downloads efficiently

### ✅ File Management
- [ ] **AC15:** Uploaded files are stored securely in cloud storage
- [ ] **AC16:** Admin can view list of all uploaded answer keys by exam
- [ ] **AC17:** File metadata (name, size, upload date) is displayed
- [ ] **AC18:** Old answer keys are archived, not deleted

## Technical Specification

### API Endpoints
- `POST /api/admin/answer-key/upload` - Upload PDF file
- `POST /api/admin/answer-key/publish` - Publish to students  
- `GET /api/results/answer-key/:examId` - Student download endpoint

### Database Changes
```sql
ALTER TABLE exams ADD COLUMN 
  answer_key_url VARCHAR(500),
  answer_key_filename VARCHAR(255),
  answer_key_uploaded_at TIMESTAMP,
  answer_key_published BOOLEAN DEFAULT FALSE,
  answer_key_published_at TIMESTAMP,
  answer_key_download_count INTEGER DEFAULT 0;
```

### File Storage
- Cloud storage (S3/equivalent) for PDF files
- Secure URLs with expiration for downloads
- CDN integration for fast global access

## UI/UX Requirements

### Admin Interface
- **Upload Section:** Drag-drop file upload with progress bar
- **Preview Panel:** PDF preview before publishing
- **Publish Button:** Clear call-to-action with confirmation dialog
- **Status Display:** Published/Draft status with timestamps
- **File List:** Table showing all answer keys for exam session

### Student Interface  
- **VVIP Dashboard:** "Download Answer Key" button when available
- **FREE Dashboard:** "Upgrade to view answer key" prompt
- **Download Experience:** Direct PDF download, no additional clicks

## Definition of Done
- [ ] Admin can upload PDF files up to 50MB
- [ ] File validation prevents non-PDF uploads
- [ ] Preview functionality works correctly
- [ ] One-click publish makes files available to VVIP students
- [ ] FREE users see appropriate upgrade messaging
- [ ] Download analytics track usage
- [ ] All actions are logged for audit trail
- [ ] Error handling provides clear user feedback
- [ ] Files are stored securely with proper access controls
- [ ] Mobile admin interface works on tablets
- [ ] Performance remains good with large PDF files
- [ ] Integration tests pass for upload/publish workflow

## Dependencies
- **Requires:** File storage service setup (S3/equivalent)
- **Requires:** Admin authentication system (Story 1.2)
- **Requires:** User tier verification system
- **Blocks:** None (independent feature)

## Risks & Mitigation
- **Risk:** Large file uploads timeout → Implement chunked upload
- **Risk:** Storage costs → Set reasonable file size limits (50MB)
- **Risk:** Download abuse → Implement rate limiting per user
- **Risk:** File corruption → Add MD5 checksum verification

## Success Metrics
- Upload success rate > 99%
- Average upload time < 30 seconds for 10MB files
- Zero security incidents with file access
- Admin satisfaction score > 4.5/5 for ease of use
- Student download success rate > 95%

## Testing Strategy

### Unit Tests
- File validation logic
- Upload progress tracking
- Publish/unpublish state management
- Access control verification

### Integration Tests
- End-to-end upload to publish workflow
- Student download permission checks
- File storage and retrieval
- Admin UI interactions

### Performance Tests
- Large file upload handling
- Concurrent download load testing
- Storage system performance
- CDN delivery optimization

## Implementation Notes
- Start with basic upload/download, add preview later if needed
- Use existing admin panel styling and components
- Implement proper error boundaries for file operations
- Consider mobile admin experience from day one
- Plan for future bulk upload capabilities